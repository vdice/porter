name: hello
version: 0.1.0
tag: getporterci/hello-with-templating

mixins:
  - exec

parameters:
  - name: tfstate
    type: file
    path: /cnab/app/tfstate
    source:
      output: tfstate

outputs:
  - name: msg
    type: string
    default: ""
  - name: tfstate
    type: file
    path: /cnab/app/outputs/tfstate
  - name: name
    type: string

install:
  - exec:
      description: "Say Hello"
      command: ./helpers.sh
      arguments:
        - install
      outputs:
        - name: name
          regex: Hello (.*)
        - name: tfstate
          path: /cnab/app/outputs/tfstate
  - exec:
      description: "Use step output"
      command: ./helpers.sh
      arguments:
        - debug
        - "{{ bundle.outputs.name }}"

upgrade:
  - exec:
      description: "Upgrade"
      command: ./helpers.sh
      arguments:
        - upgrade
        - "{{ bundle.outputs.msg }}"

uninstall:
  - exec:
      description: "Say Goodbye"
      command: ./helpers.sh
      arguments:
        - uninstall
        - "{{ bundle.outputs.msg }}"

